<link rel="stylesheet" href="/public/css/account.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<form method="POST" enctype="multipart/form-data" id="form_table" class="form-1" name="form_table" novalidate>
    <div class="container rounded bg-white mt-5 mb-5" id="account_table">
        <div class="row">
            <div class="col-md-3 border-right">
                <div class="d-flex flex-column align-items-center text-center p-3 py-5">
                    <div class="container">
                        <div class="picture-container">
                            <div class="picture">
                                <img src="{{user.avatar}}" alt="https://lh3.googleusercontent.com/LfmMVU71g-HKXTCP_QWlDOemmWg4Dn1rJjxeEsZKMNaQprgunDTtEuzmcwUBgupKQVTuP0vczT9bH32ywaF7h68mF-osUSBAeM6MxyhvJhG6HKZMTYjgEv3WkWCfLB7czfODidNQPdja99HMb4qhCY1uFS8X0OQOVGeuhdHy8ln7eyr-6MnkCcy64wl6S_S6ep9j7aJIIopZ9wxk7Iqm-gFjmBtg6KJVkBD0IA6BnS-XlIVpbqL5LYi62elCrbDgiaD6Oe8uluucbYeL1i9kgr4c1b_NBSNe6zFwj7vrju4Zdbax-GPHmiuirf2h86eKdRl7A5h8PXGrCDNIYMID-J7_KuHKqaM-I7W5yI00QDpG9x5q5xOQMgCy1bbu3St1paqt9KHrvNS_SCx-QJgBTOIWW6T0DHVlvV_9YF5UZpN7aV5a79xvN1Gdrc7spvSs82v6gta8AJHCgzNSWQw5QUR8EN_-cTPF6S-vifLa2KtRdRAV7q-CQvhMrbBCaEYY73bQcPZFd9XE7HIbHXwXYA=s200-no"
                                 class="picture-src" id="avatarPreview" title="">
                                <input type="file" id="avatar" name="avatar" accept="image/*" class="" value="/public/images/users/avatar/{{email}}.jpg">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-5 border-right">
                <div class="p-3 py-5">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="text-right">Profile Settings</h4>
                    </div>
                    <div class="row mt-2">
                        {{#unless isEmail}}
                        <div class="col-md-12"><label for="email" class="labels">Email</label><input type="text" class="email" placeholder="email" id="email" name="email" value="{{email}}"><span class="form__group-message email-message"></span></div>
                        {{/unless}}
                        {{#if isEmail}}
                        <div class="col-md-12"><label for="email" class="labels">Email</label><input disabled style="color: gray;" type="text" class="email" placeholder="email" id="email" name="email" value="{{email}}"><span class="form__group-message email-message"></span></div>
                        {{/if}}
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6"><label for="fullname" class="labels">FullName</label><input type="text" class="fullname" placeholder="name" id="fullname" name="fullname" value="{{user.fullname}}"><span class="form__group-message email-message"></span></div>
                        {{#unless isEmail}}
                            <div class="col-md-6"><label for="password" class="labels">Password</label><input type="password" class="password" value="********" id="password" name="password" placeholder="password" required><span class="form__group-message email-message"></span></div>
                        {{/unless}}
                        {{#if isEmail}}
                            <div class="col-md-6"><label for="password" class="labels">Password</label><input disabled style="color: gray;" type="password" class="password" value="********" id="password" name="password" placeholder="password" required><span class="form__group-message email-message"></span></div>
                        {{/if}}
                    </div>
                    <div class="mt-5 text-center"><button class="btn btn-primary profile-button" type="submit">Save Profile</button></div>
                </div>
            </div>
            <div class="col-md-4">
                {{!-- <div class="p-3 py-5">
                    <div class="d-flex justify-content-between align-items-center experience"><span>Edit Experience</span><span class="border px-3 p-1 add-experience"><i class="fa fa-plus"></i>&nbsp;Experience</span></div><br>
                    <div class="col-md-12"><label class="labels">Experience in Designing</label><input type="text" class="form-control" placeholder="experience" value=""></div> <br>
                    <div class="col-md-12"><label class="labels">Additional Details</label><input type="text" class="form-control" placeholder="additional details" value=""></div>
                </div> --}}
                <div class="image-upload-wrap" style="display: none;">
                    <input class="file-upload-input" id="cover" name="cover" type='file' value="/public/images/users/cover/{{email}}.jpg" onchange="readURL2(this);" accept="image/*" />
                    <div class="drag-text">
                        <h3>Drag and drop a file or select to add cover Image</h3>
                    </div>
                </div>
                <div class="file-upload-content">
                    <img class="file-upload-image" src="{{user.cover}}" alt="your image" />
                    <div class="image-title-wrap">
                        <button type="button" onclick="removeUpload()" class="remove-image">Remove <span class="image-title">Cover Image</span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<script>
    $(document).ready(function(){
// Prepare the preview for profile picture
    $("#avatar").change(function(){
        readURL(this);
    });
});
function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $('#avatarPreview').attr('src', e.target.result).fadeIn('slow');
        }
        reader.readAsDataURL(input.files[0]);
    }
}
</script>
<script>
    function readURL2(input) {
  if (input.files && input.files[0]) {

    var reader = new FileReader();

    reader.onload = function(e) {
      $('.image-upload-wrap').hide();

      $('.file-upload-image').attr('src', e.target.result);
      $('.file-upload-content').show();

      
    };

    reader.readAsDataURL(input.files[0]);

  } else {
    removeUpload();
  }
}

function removeUpload() {
  $('.file-upload-input').replaceWith($('.file-upload-input').clone());
  $('.file-upload-content').hide();
  $('.image-upload-wrap').show();
}
$('.image-upload-wrap').bind('dragover', function () {
		$('.image-upload-wrap').addClass('image-dropping');
	});
	$('.image-upload-wrap').bind('dragleave', function () {
		$('.image-upload-wrap').removeClass('image-dropping');
});

</script>

<script src="/public/script/validate.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    Validator(
        {
            form: ".form-1",
            error_message: ".form__group-message",
            rules: [
                Validator.isRequire(".fullname"),
                Validator.isRequire(".email"),
                Validator.isRequire(".password"),

                Validator.isEmail(".email"),
                Validator.minLength(".password", 8),
                Validator.isConfirm(".confirm-password", () => {
                    return document.querySelector(`.form-1 input[type="password"]`).value
                }),
            ],
            onSubmit: function (data) {
                let email = document.querySelector("#email").value;
				$.post("/auth/check-current-email",
					{
						email
					},
					function(data, status){
						if(data.exists == false){
							document.querySelector(".form-1").submit()
						}else{
                            Swal.fire({
								width: 600,
								icon:`error`,
								title: `Your email already exists. Please use other email!`,
								showConfirmButton: false,
								timer: 2500
							})
						}				
				    }
                );
            }
        })
</script>
{{#if isAlert}}
    <script>
        Swal.fire({
  icon: '{{icon}}',
  title: '{{title}}',
  showConfirmButton: false,
  timer: 1500
})
    </script>
{{/if}}